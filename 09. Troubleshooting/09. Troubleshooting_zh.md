# 故障排除

对 IPv6 问题进行故障排除需要遵循网络故障排除方法论中广泛使用的既定最佳实践：

1. **观察行为：** 清晰定义并记录意外或不良的网络行为。
1. **与基准对比：** 如果可用，将当前状态与之前建立并记录的基准进行比较。
1. **记录变更：** 维护网络配置和任何修改的准确记录。
1. **进行简单的单一变更：** 一次实施一个变更以有效隔离变量。
1. **重复：** 继续迭代该过程直到问题得到解决。

由于它们的相似性，IPv4 故障排除技术高度适用于 IPv6，因为这两种协议都是可路由的、支持各种服务、在主机和网络设备上运行，并促进管理流量。

## 第 2 层通信故障排除

IPv6 的第 2 层故障排除涉及确保数据链路层的基本连接，包括：

- **地址解析：** 验证邻居发现协议（NDP）的正常运行，因为 IPv6 不使用 ARP。常用命令包括：

  ```bash
  # 显示 IPv6 邻居
  ip -6 neigh
  ```

- **检查链路本地连接：** 使用链路本地地址确认本地通信。这将问题隔离到本地网段。

  ```bash
  # 使用链路本地地址进行 ping
  ping6 fe80::<interface-id>%<interface-name>
  ```

- **组播侦听器发现（MLD）：** 确保组播侦听器正常运行，因为 NDP 严重依赖组播。

## 第 3 层通信故障排除

第 3 层故障排除涉及验证 IPv6 网络的路由和可达性：

- **IPv6 路由表：** 检查路由表以获取正确和完整的条目。

  ```bash
  # 显示 IPv6 路由表
  ip -6 route
  ```

- **ICMPv6 诊断：** 使用 ICMPv6 工具（如 ping6 和 traceroute6）来验证端到端连接和路径确定。

  ```bash
  ping6 2001:db8::1
  traceroute6 2001:db8::1
  ```

- **服务可用性：** 验证网络服务（DNS、DHCP、Web 服务）对 IPv4 和 IPv6 请求的正确响应。

  ```bash
  dig A example.com
  dig AAAA example.com
  ```

- **性能基准：** 持续监控双栈性能以检测和修复次优的 IPv6 连接。

## 快乐眼球算法

"快乐眼球"算法（RFC 8305）通过动态选择提供最佳用户体验的协议来优化双栈体验：

- **行为分析：** 观察应用程序发起的连接，并验证当 IPv6 连接较差或失败时，它是否适当地回退到 IPv4。
- **超时调整：** 调整应用程序内的计时器，以优化 IPv4 回退速度和 IPv6 偏好之间的平衡。
- **诊断工具：** 利用浏览器开发者工具或数据包捕获（Wireshark、tcpdump）实时监控应用程序行为。

有效的 IPv6 故障排除可确保现代网络高效运行，充分利用 IPv6 的优势，同时保持从 IPv4 的无缝过渡。

## [高级故障排除](Advanced%20Troubleshooting.md)

## [工具](Tools.md)

<!-- Link lines generated automatically; do not delete -->

### [<ins>返回主目录</ins>](../Contents.md)
