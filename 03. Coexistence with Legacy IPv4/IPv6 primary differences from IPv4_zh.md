## IPv6 与 IPv4 的主要区别

本书有意将 IPv6 描述为"新常态"IP 协议，但本节提到它与 IPv4 不同的主要方式，使用
[2. IPv6 基本技术](../02.%20IPv6%20Basic%20Technology) 中的术语。

IPv6 在传输路由方面非常相似，但在主机的第一跳以及执行纯路由以外操作的路由器方面有一些相当大的差异。

主要区别是：

- 第一个区别是理想和预期的：IPv6 的地址大小是四倍（128 位对 32 位）。

  SLAAC 在 IPv6 上比 DHCPv6 使用得更多。SLAAC 子网前缀是 64 位，这是出于历史原因，在许多标准中是固定的。2^64 个主机当然不可能在一个子网中，但即使对于智能手机，地址空间也是保留的。因此，有效的 IPv6 地址空间是多少是有争议的。它大于 2^64 位，但 64 位 IID 位用于隐私和安全，而不是用于寻址*本身*。

- NAT44 是 IPv4 网络中的常见解决方案。

  NAT66 被 IETF 劝阻，并且未被指定为标准。IPv6 端到端连接被认为是一个巨大的价值。

- IPv4 每个接口只有一个地址（没有特殊技巧）。

  每个接口上有许多 IPv6 地址是常态。这不仅是不同的地址类型（LLA、ULA 和 GUA），而且还有许多 GUA 和 ULA 的实例，用于安全或虚拟化原因。流行的 ChromOS 至少有七个 IPv6 地址。此外，在链路重新编号的情况下，每个接口的 IPv6 地址数量几乎可以翻倍。

- IPv4 仅有集中式 DHCPv4 地址获取。

  IPv6 还有通过 SLAAC 的分布式地址获取，这被广泛采用。SLAAC 显著改变了链路操作的逻辑。（广播 IPv4 ARP 引起的问题被组播 IPv6 邻居请求引起的问题所取代！）

- IPv4 有一个复杂的（许多字段）和理论上可变的头部，实际上是固定的，因为选项没有被广泛使用。

  IPv6 有一个简单且固定的头部。此外，IPv6 可以有扩展头部，允许在数据平面上无限的协议可扩展性。许多扩展头部已经在有限的域中使用。就像 IPv4 选项一样，在开放互联网上部署新的 IPv6 扩展头部和选项是有问题的。

- IPv4 分片在基本头部中，并且在传输中是允许的。

  IPv6 分片使用扩展头部，在传输中是禁止的。

- IPv4 在链路上通过 ARP 协议进行地址解析是在第 2 层（对于 IEEE 802 媒体，它是 IEEE 802 帧）。IPv6 在链路上通过 ND 协议进行地址解析是在第 3 层（通过 LLA 或其他 IP 地址的 IPv6 数据包）。

- IPv4 本身不需要组播。

  组播对于 IPv6 链路操作是强制性的。许多 ND 功能使用组播。这可能会带来优势（对于以太网）和劣势（对于许多类型的无线）。

上述列表并不全面，但其他差异可能较小。

一个明显的问题是：有了所有这些差异，IPv6 和 IPv4 之间的性能差异是什么？这个问题没有简单的答案。由于 IPv6 数据包头比 IPv4 大 20 个字节，承载全尺寸 IPv6 数据包的链路的原始有效负载吞吐量略低于 IPv4（对于 1500 字节数据包约低 1.3%）。然而，许多其他因素发挥作用，测量通常显示 IPv6 的端到端性能更好。例如，在大多数国家
[Google 统计](https://www.google.com/intl/en/ipv6/statistics.html#tab=per-country-ipv6-adoption)
显示 IPv6 的延迟（传输时间）更低。最安全的总结是没有显著的性能差异。

<!-- Link lines generated automatically; do not delete -->

### [<ins>上一页</ins>](Obsolete%20techniques.md) [<ins>下一页</ins>](../04.%20Security/04.%20Security.md) [<ins>顶部</ins>](03.%20Coexistence%20with%20Legacy%20IPv4.md)
