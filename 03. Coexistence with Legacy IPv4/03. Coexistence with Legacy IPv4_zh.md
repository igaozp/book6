# 与传统 IPv4 共存

一个乌托邦式的纯 IPv6 世界的概念是一个崇高的目标。然而，与任何构造性变革一样，它的发生是缓慢的，不同的元素会同时存在。因此，应该认识到，在许多情况下，与传统 IPv4 共存是常态，虽然应该将其视为过渡状态，但它可能会持续很长或不确定的时间。自 2012 年以来，IETF 因此要求所有新的或更新的互联网协议实现都必须支持 IPv6
\[[BCP177](https://www.rfc-editor.org/info/bcp177)\]。

共存的理由各不相同，通常只与特定环境本地相关。可能是由于需要使用不支持 IPv6 的传统硬件，而这需要超出组织预算的资本支出，例如专用的操作技术设备，或者可能是由于滞后的合规性法规未能跟踪当前的技术标准。也可能仅仅是成本/效益分析的结论。无论如何，理由并不如支持双栈环境所需的细节重要。

在描述 IPv6/IPv4 共存的具体技术——双栈、隧道和转换器之前，回答新手有时会问的一个基本问题是有用的：_为什么 IPv6 不向后兼容 IPv4？_ 答案很简单：这在数学上是不可能的。IPv4 除了 32 位之外不包含任何其他地址长度的规定。即使只将地址长度延长一位，更不用说延长 32 位或更多位，都会完全破坏所有现有的 IPv4 实现。因此，__IP 数据包级别的向后兼容是不可能的，所以不是设计目标。__

鉴于这种根本的不兼容性，IPv6 的设计者决定满足 IPv4 永远无法满足的许多需求。因此，IP 数据包头根据经验被重新设计。这除了对实际处理原始数据包的低级代码有影响外，没有其他影响。

另一个基本决策是从一开始就开发一个共存模型，因为很明显，快速过渡到新版本的 IP 是不可想象的。简而言之，*双栈*最初意味着主机和路由器能够同时处理 IPv4 和 IPv6。最近，这种简单的双栈观点因引入"IPv4 即服务"而变得复杂，如下所述。*隧道*意味着 IPv6 主机可以通过封装其数据包在 IPv4 网络上相互通信，反之亦然。*转换*意味着，在有限的方式下，IPv6 主机可以通过转换机制与 IPv4 主机通信。以下各节更详细地讨论这三种共存方法。后面的章节列出了一些不再推荐的机制，以及 IPv4 和 IPv6 之间的主要区别。

我们首先为这个复杂的主题提供两个相当通用的参考：

1. 尽管已有几年历史，
   [RFC 6180](https://www.rfc-editor.org/info/rfc6180) 提供了部署各种 IPv6 过渡机制的有用指南。

1. 当今运营商希望简化其基础设施的一种常见策略是在底层 IPv6 层之上提供 IPv4 作为*服务*。实现这一目标的各种方法在
   [RFC 9313](https://www.rfc-editor.org/info/rfc9313) 中有所描述。

随着网络从 IPv4 迁移到纯 IPv6 环境，他们无疑会发现由不完整的协议栈、缺乏功能和未公开的配置旋钮组成的意外障碍。这些几乎肯定会在网络的边缘被发现。诸如电源控制器、光复用平台、机械控制系统和其他专业硬件等元素往往具有非常长的平均更换时间，以及缓慢现代化的固件产品。操作技术和 SCADA 系统的更新也非常缓慢，可能在网络中存在多年，甚至几十年。在家庭网络中，旧的网络设备可能会持续多年。认识到这一点，应该预期会存在一个或多个在网络寻址方案上有所不同的飞地。

总结共存场景，我们有：

- 纯 IPv4 飞地：

  由于合规性、技术、政策、预算或其他战略原因，IPv6 根本不可能或不可取的区域可以作为纯 IPv4 或传统 IP 飞地运行。这可能是迁移发生在飞地周围的结果，或者可能是为容纳传统服务、设备或应用程序栈而有意创建的段。重要的是要接受可能存在长期的飞地，其中传统 IPv4 是硬性要求。然而，这一事实应该为政策提供信息，但在理想情况下不一定定义它。

- "线路上"的 IPv4-IPv6 双栈

  - 支持"擦肩而过的船"协议
    - 一致的策略
    - 监控和测量
    - 互联网内的多拓扑
  - 广泛部署但需要双重管理

- 纯 IPv6 基础设施网络

  - 对 IPV6 资源的原生访问
  - 通过 IPv4 即服务访问纯 IPv4 资源
  - 降低管理复杂性
  - 仍然向上层 API 呈现双栈

从长远来看，可以想象互联网上所有有用的资源都可以通过 IPv6 访问，在这种情况下，IPv4 即服务可能会停止，让纯 IPv4 飞地自生自灭。然而，目前还没有时间表说明这可能何时发生。

本章是关于 IPv6/IPv4 共存的，因为纯 IPv6 飞地只有在支持至少一种共存机制的情况下才能成为整个互联网的一部分。从理论上讲，这样的飞地可以通过应用层网关连接到互联网，但我们不进一步描述这一点。一个完全没有共存机制的 IPv6 网络超出了本书的范围。

<!-- Link lines generated automatically; do not delete -->

## [双栈场景](Dual%20stack%20scenarios.md)

## [隧道](Tunnels.md)

## [转换和 IPv4 即服务](Translation%20and%20IPv4%20as%20a%20service.md)

## [过时的技术](Obsolete%20techniques.md)

## [IPv6 与 IPv4 的主要区别](IPv6%20primary%20differences%20from%20IPv4.md)

### [<ins>返回主目录</ins>](../Contents.md)
