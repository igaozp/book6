## 地址规划

正如你所期望的，在 IPv6 网络中，所有节点都可以拥有全局唯一地址。所有网络将至少获得一个 /64 全局前缀来运行。运营商应该向其订户提供更短的前缀（通常在 /48 到 /56 的范围内）
\[[RFC6177](https://www.rfc-editor.org/info/rfc6177)\]，这允许在订户组织或家庭环境中使用多个 /64 子网。即使是家庭客户也可以拥有一个公共网络前缀，将其分割成更小的网络，这是从少数公共 IPv4 地址（甚至在 `100.64.0.0/10` 内部 \[[RFC6598](https://www.rfc-editor.org/info/rfc6598)\]）"隐藏在 NAT 后面"的范式转变。

在 IPv6 网络中，通常需要管理接收到的前缀，即使它是由 CE 路由器自动完成的。同样，网络运营商从 RIR 接收大型地址块，必须规划其地址分配，以便处理分配给客户或其自己基础设施的地址块。

例如，我们可以从网络运营商开始。考虑一个名为"ISP"的运营商，它接收到前缀 `2001:db8::/32`。有必要分离分配给家庭客户、企业客户和 ISP 自己基础设施的地址块。首先，让我们看看有什么空间可用于规划：

```
 Global ID -Subnets- -- Interface IDs --
| 32 bits | 32 bits |   64 bits         |
 2001:0db8:0000:0000:0000:0000:0000:0000
```

前 32 位当然保持不变，最后 64 位将始终属于终端子网节点。这给我们留下了中间的 32 位来工作。请记住，不用担心 IPv6 地址（或前缀）的耗尽，因为这个为自治系统（ISP）分配的单个地址空间相当于整个 IPv4 互联网地址空间。而且这不是关于唯一地址，而是 /64 网络前缀！作为类比，/64 前缀相当于向单个网络或订户租用一个公共 IPv4 地址。通过这种方式，在 IPv6 规划中，我们可以优先考虑组织和更清晰的管理，而不是尽可能节省地址。在 IPv6 网络上，计算唯一地址没有意义；相反，我们考虑可用的 /64 前缀数量。将 /64 前缀视为适合所有网络规模的标准单元。

请记住，我们的 32 位子网空间包含 40 亿个 /64 网络，因此有良好的规划和管理空间，因为在任何合理的时间范围内都不会出现地址短缺。良好的地址规划应该始终为未来扩展留有空间，并有利于网络聚合和管理。（当然，即使是 IPv6 地址空间也不是无限的，但各个地区地址注册机构应用的政策将避免任何耗尽的风险。）因此，在以下示例中，我们将使用被称为**最左侧**的技术，以保证在所有可用空间上更平衡的分配。回到示例，考虑我们的 32 位，我们可以使用前 4 位（一个"半字节"或十六进制字符）来分配十六个区域，从 0 到 F，每个区域得到一个 /36。一个区域可以是数据中心、地理区域或分支网络。

```
A. Region A - 主数据中心
B. Region B - 南部城市
C. Region C - 北部城市
```

因此，我们地址规划的第一层可能如下所示：

```
2001:0db8:0000::/36 - 保留
2001:0db8:1000::/36 - 保留
2001:0db8:2000::/36 - 保留
2001:0db8:3000::/36 - 保留
2001:0db8:4000::/36 - 保留
2001:0db8:5000::/36 - 保留
2001:0db8:6000::/36 - 保留
2001:0db8:7000::/36 - 保留
2001:0db8:8000::/36 - 保留
2001:0db8:9000::/36 - 保留
2001:0db8:A000::/36 - 区域 A
2001:0db8:B000::/36 - 区域 B
2001:0db8:C000::/36 - 区域 C
2001:0db8:D000::/36 - 保留
2001:0db8:E000::/36 - 保留
2001:0db8:F000::/36 - 保留
```

（注意：我们使用大写字符来区分本地分配的前缀；这打破了使用小写的通常建议。）

每个区域都有功能部门，可能获得一个或多个地址块。每个部门可以是例如：

1. 内部基础设施
1. 家庭客户
1. 企业客户 使用相同的逻辑，你可以将一个区域的 /36 分成 16 个 /40 前缀，这样更容易管理。请记住，如果需要，可以为每个部门分配更多前缀。现在让我们看看**区域 A** 的地址规划，其中我们有 16 个 /40 前缀：

```
2001:0db8:A000::/40 - 企业客户 ---|
2001:0db8:A100::/40 - 企业客户    |---> 1024 个 /48 前缀
2001:0db8:A200::/40 - 企业客户    |
2001:0db8:A300::/40 - 企业客户 ---|
2001:0db8:A400::/40 - 内部基础设施 ---> 256 个 /48 前缀用于基础设施
2001:0db8:A500::/40 - 保留
2001:0db8:A600::/40 - 保留 ---> 768 个 /48 前缀用于扩展
2001:0db8:A700::/40 - 保留
2001:0db8:A800::/40 - 家庭客户 ---|
2001:0db8:A900::/40 - 家庭客户    | 2048 个 /48 前缀
2001:0db8:AA00::/40 - 家庭客户    | 或
2001:0db8:AB00::/40 - 家庭客户    | 2001:db8:A800::/37
2001:0db8:AC00::/40 - 家庭客户    | 或
2001:0db8:AD00::/40 - 家庭客户    | 2048 × 256 个 /56 前缀
2001:0db8:AE00::/40 - 家庭客户    |
2001:0db8:AF00::/40 - 家庭客户 ---|
```

如上所示，我们为企业和家庭客户提供了良好的规模，加上扩展空间，以及一个慷慨的 /40 仅用于内部基础设施。当然，这可以根据每种情况的需要进行更改。例如，增加企业客户的前缀数量，或占用基础设施保留部分的一些空间，该部分非常大。甚至为同一区域添加另一个完整的 /36 块。如果你计算一下，数字总是非常宽松，以便我们始终可以优先考虑地址组织、聚合和良好管理。

### 客户委派

建议至少向客户委派一个 /48 块。最佳实践表明，企业客户总是至少接收一个 /48 前缀，家庭客户至少接收一个 /56 前缀。移动接入客户可能接收单个 /64（但更多会更好，以允许 IPv6"热点"）。请参见下面来自区域 A 的 /40 块的 2 个前缀：分配给企业客户的 /48 和分配给家庭客户的 /56：

1. `2001:0db8:A3CC:0000::/48` 最后四个零显示在 /48 前缀内提供的 16 位，可用于寻址 2^16=65536 个 /64 子网。
1. `2001:0db8:ABDD:DD00::/56` 最后两个零代表在 /56 前缀内提供的 8 位，可用于寻址 2^8=256 个 /64 子网。

可以看到，单个企业客户可获得几乎无限的地址空间，家庭订户可以在家庭网络上拥有 256 个子网。一旦客户租用了一个地址块，它必须将其分割为网络内的给定子网。让我们以同一个拥有 `2001:0db8:ABDD:DD00::/56` 前缀的家庭客户为例，看看我们能做什么：

```
2001:0db8:ABDD:DD00::/64 ---> 主要家庭子网
2001:0db8:ABDD:DD01::/64 ---> Wi-Fi 子网
2001:0db8:ABDD:DD02::/64 ---> Wi-Fi 访客子网
2001:0db8:ABDD:DD(...)::/64 ---> 保留
2001:0db8:ABDD:DDFE::/64 ---> IoT 子网
2001:0db8:ABDD:DDFF::/64 ---> VoIP 子网
```

ISP 客户通常通过 **DHCPv6 前缀委派** \[[RFC8415](https://www.rfc-editor.org/info/rfc8415)\] 租用地址块。客户端路由器不是只获取一个面向互联网的地址，而是请求整个 GUA 块。一旦获得它，较小的 /64 块通常作为前缀池处理，其中每个块都分配给一个内部子网。

### 其他信息来源

Daryll Swer 写了一篇优秀的
[博客](https://www.daryllswer.com/ipv6-architecture-and-subnetting-guide-for-network-engineers-and-operators/)
涵盖子网和地址设计（也可从
[APNIC](https://blog.apnic.net/2023/04/04/ipv6-architecture-and-subnetting-guide-for-network-engineers-and-operators/) 获得）。

虽然年代久远，但以下书籍可能会有所帮助：
Tom Coffeen 的 [IPv6 地址规划](https://www.oreilly.com/library/view/ipv6-address-planning/9781491908211/)。

<!-- Link lines generated automatically; do not delete -->

### [<ins>下一页</ins>](Prefix%20per%20Host.md) [<ins>顶部</ins>](05.%20Network%20Design.md)
