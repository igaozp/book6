## 数据包格式

IPv6数据包彼此独立传输，即使它们属于同一应用程序会话，因此它们有时被称为*数据报*。基本的数据报头如下所示。（该图为32位宽，大端序。）

```
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Version| Traffic Class |           Flow Label                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Payload Length        |  Next Header  |   Hop Limit   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   +                         Source Address                        +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   +                      Destination Address                      +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

(紧接着是一个或多个"下一个头"，包括上层有效载荷。)
```

关于这些固定字段的一些注释：

- 版本（Version）：始终为6

- 流量类（Traffic class）：六位
  [差异化服务代码点](https://www.rfc-editor.org/info/rfc2474)
  （DSCP），后跟两个[ECN](https://www.rfc-editor.org/info/rfc3168)位。参见
  [流量类和流标签](Traffic%20class%20and%20flow%20label.md)。

- 流标签（Flow label）：20位。应该是给定流量流唯一的伪随机值。参见
  [流量类和流标签](Traffic%20class%20and%20flow%20label.md)。

- 有效载荷长度（Payload length）：此IPv6头之后的数据包其余部分的长度，以字节为单位计数。

- 下一个头（Next header）：定义后续头类型的整数。

- 跳数限制（Hop limit）：在每个路由跳数减少。当达到零时，数据包被丢弃。

- 地址（Addresses）：128位；见下文。

"下一个头"是设计的一个重要方面。在刚刚定义的固定头之后，有一个或多个额外的头链接在一起。最好的描述可能在
[标准本身](https://www.rfc-editor.org/info/rfc8200)中，所以我们这里只给出一个摘要。每个头格式都有已知的长度，并包含一个标识下一个头的"下一个头"字段。数据包中的最后一个头通常是包含实际有效载荷的TCP或UDP头。最后一个头自然有一个"下一个头"字段，但它包含魔术数字59，这意味着"没有下一个头"，并终止链。

（标准似乎允许一个数据包，其初始"下一个头"为59，因此没有扩展头和有效载荷。没有理由为此失眠。）

较早的头具有包括以下功能：

- 逐跳选项，用于应由路径上每个节点检查的数据包级选项。

- 分片头，当数据包已被分片时（仅在源端发生，如果原始数据包超过传输路径的已知MTU，至少为IPv6的最小MTU 1280字节）。

- 目标选项，用于仅在目标节点有用的数据包级选项。

- 路由头，如果需要非标准路由。

- 封装安全有效载荷，如果使用
  [IPsec](https://www.rfc-editor.org/info/rfc4303)。

IPv6的一个有趣特性是扩展头类型与IP协议号从同一空间编号。UDP的下一个头类型为17，与IPPROTO_UDP相同，这不是巧合；这是设计决定。最新的有效扩展头类型集始终可从
[IANA](https://www.iana.org/assignments/ipv6-parameters/ipv6-parameters.xhtml)获得。

扩展头和选项在
[扩展头和选项](Extension-headers-and-options.md)部分中有更详细的描述。还值得注意的是，Wireshark了解所有关于IPv6头格式的信息。

<!-- Link lines generated automatically; do not delete -->

### [<ins>下一页</ins>](Addresses.md) [<ins>顶部</ins>](02.%20IPv6%20Basic%20Technology.md)
